# ============================================
# AI 로그 분석 서비스 - 로컬 테스트용 환경변수
# ============================================
#
# 사용법:
#   uvicorn app.main:app --reload --env-file .env.test
#
# 주의: 이 파일은 로컬 테스트 전용입니다.
#       프로덕션 배포 시에는 .env 파일을 사용하세요.
# ============================================

# === OpenAI API via GMS (필수) ===
# SSAFY GMS에서 발급받은 API 키를 사용하세요
# GMS 포털: https://gms.ssafy.io/
OPENAI_API_KEY=S13P32A306-d97c850c-b280-45f1-a3ad-a4a58858e489
OPENAI_BASE_URL=https://gms.ssafy.io/gmsapi/api.openai.com/v1
EMBEDDING_MODEL=text-embedding-3-large
LLM_MODEL=gpt-4o-mini

# === OpenSearch 설정 (로컬 테스트용) ===
# 로컬 Docker 컨테이너에 접속하기 위해 localhost 사용
OPENSEARCH_HOST=localhost
OPENSEARCH_PORT=9200
OPENSEARCH_USER=admin
OPENSEARCH_PASSWORD=admin
OPENSEARCH_USE_SSL=false
OPENSEARCH_VERIFY_CERTS=false

# === Kafka 설정 (선택사항) ===
# 로컬 테스트에서는 Kafka 없이도 동작 가능
# Kafka를 사용하려면 docker-compose로 실행 후 아래 주석 해제
# KAFKA_BOOTSTRAP_SERVERS=localhost:9092
# KAFKA_TOPIC=application-logs
# KAFKA_GROUP_ID=log-analysis-consumer-test

# === 애플리케이션 설정 ===
APP_NAME=log-analysis-api-test
APP_VERSION=1.0.0
ENVIRONMENT=development
SERVICE_PORT=8000
LOG_LEVEL=DEBUG

# === CORS 설정 (로컬 개발용) ===
# 쉼표로 구분된 문자열 형식 사용 (JSON 배열 형식 불가)
CORS_ORIGINS=http://localhost:3000,http://localhost:5173,http://localhost:8080,https://loglens.co.kr,https://www.loglens.co.kr

# === 분석 설정 ===
SIMILARITY_THRESHOLD=0.8
MAX_CONTEXT_LOGS=5

# === 캐싱 설정 ===
CACHE_CANDIDATE_SIZE=5
DEFAULT_CACHE_TTL=1800
SHORT_CACHE_TTL=600
LONG_CACHE_TTL=86400

# === Map-Reduce 설정 ===
ENABLE_MAP_REDUCE=true
MAP_REDUCE_THRESHOLD=10
LOG_CHUNK_SIZE=5

# === 검증 설정 (답변 품질 검증) ===
VALIDATION_STRUCTURAL_THRESHOLD=0.7    # 구조적 검증 임계값 (형식, 필드 존재)
VALIDATION_CONTENT_THRESHOLD=0.6       # 내용 검증 임계값 (근거 일치성 포함!)
VALIDATION_OVERALL_THRESHOLD=0.65      # 종합 통과 기준
VALIDATION_MAX_RETRIES=2               # 검증 실패 시 최대 재시도 횟수
VALIDATION_ENABLE_RETRY=true           # 검증 실패 시 재시도 활성화

# === LLM 타임아웃 설정 ===
LLM_REQUEST_TIMEOUT=120
