# ===========================================
# Spring Boot Log Parsers
# ===========================================

# JSON 로그 파서 (MethodLoggingAspect 출력)
[PARSER]
    Name        json
    Format      json
    Time_Key    @timestamp
    Time_Format %Y-%m-%dT%H:%M:%S.%LZ
    Time_Keep   On


# JSON 또는 텍스트 구분 파서
[PARSER]
    Name        json_or_text
    Format      json
    Time_Key    @timestamp
    Time_Format %Y-%m-%dT%H:%M:%S.%LZ
    Time_Keep   On

# Spring Boot 텍스트 로그 파서
[PARSER]
    Name        spring_boot_text
    Format      regex
    Regex       ^(?<timestamp>\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}\.\d{3}\+\d{2}:\d{2})\s+(?<log_level>[A-Z]+)\s+(?<pid>\d+)\s+---\s+\[(?<app_name>[^\]]+)\]\s+\[(?<thread>[^\]]+)\]\s+(?<logger>\S+)\s*:\s*(?<message>.*)$
    Time_Key    timestamp
    Time_Format %Y-%m-%dT%H:%M:%S.%L%z
    Time_Keep   On

# 첫 줄 감지 (멀티라인 로그용)
[PARSER]
    Name        spring_boot_firstline
    Format      regex
    Regex       ^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}\.\d{3}
    Time_Keep   Off

# 멀티라인 메인 파서
[PARSER]
    Name        spring_boot_main
    Format      regex
    Regex       ^(?<timestamp>\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}\.\d{3}\+\d{2}:\d{2})\s+(?<log_level>[A-Z]+)\s+(?<pid>\d+)\s+---\s+\[(?<app_name>[^\]]+)\]\s+\[(?<thread>[^\]]+)\]\s+(?<logger>\S+)\s*:\s*(?<message>.*(?:\n.*)*)$
    Time_Key    timestamp
    Time_Format %Y-%m-%dT%H:%M:%S.%L%z
    Time_Keep   On

# Hibernate SQL 로그 파서 (선택사항)
[PARSER]
    Name        hibernate
    Format      regex
    Regex       ^Hibernate:\s+(?<sql>.*)$
    Time_Keep   Off

# 스택 트레이스 파서
[PARSER]
    Name        java_stacktrace
    Format      regex
    Regex       ^\s+at\s+(?<stacktrace>.*)$
    Time_Keep   Off

# ===========================================
# Infrastructure Log Parsers
# ===========================================

# ===========================================
# MySQL Log Parsers
# ===========================================

# MySQL Error Log Parser
[PARSER]
    Name        mysql_error
    Format      regex
    Regex       ^(?<timestamp>\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}\.\d+\+\d{2}:\d{2})\s+(?<thread_id>\d+)\s+\[(?<level>[^\]]+)\]\s+(?:\[(?<error_code>[^\]]+)\]\s+)?(?:\[(?<subsystem>[^\]]+)\]\s+)?(?<message>.*)$
    Time_Key    timestamp
    Time_Format %Y-%m-%dT%H:%M:%S.%L%z
    Time_Keep   On

# MySQL Slow Query Log - First Line (멀티라인 시작)
[PARSER]
    Name        mysql_slow_firstline
    Format      regex
    Regex       ^# Time: (?<timestamp>\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}\.\d+\+\d{2}:\d{2})
    Time_Key    timestamp
    Time_Format %Y-%m-%dT%H:%M:%S.%L%z
    Time_Keep   On

# MySQL Slow Query Log - Body (멀티라인 본문)
[PARSER]
    Name        mysql_slow_body
    Format      regex
    Regex       ^(?:# User@Host: (?<user>\w+)\[(?<user_alias>\w+)\]\s+@\s+(?<host>[^\s]+)\s+\[(?<ip>[^\]]*)\]\s+Id:\s+(?<connection_id>\d+))|(?:# Query_time: (?<query_time>[\d\.]+)\s+Lock_time: (?<lock_time>[\d\.]+)\s+Rows_sent: (?<rows_sent>\d+)\s+Rows_examined: (?<rows_examined>\d+))|(?:SET timestamp=(?<query_timestamp>\d+);)|(?:use (?<database>\w+);)|(?<query>.*)
    Time_Keep   Off

# Docker 표준 로그 파서
[PARSER]
    Name        docker
    Format      json
    Time_Key    time
    Time_Format %Y-%m-%dT%H:%M:%S.%L%z
    Time_Keep   On

# Syslog 파서 (RFC3164)
[PARSER]
    Name        syslog
    Format      regex
    Regex       ^\<(?<pri>[0-9]+)\>(?<time>[^ ]* {1,2}[^ ]* [^ ]*) (?<host>[^ ]*) (?<ident>[a-zA-Z0-9_\/\.\-]*)(?:\[(?<pid>[0-9]+)\])?(?:[^\:]*\:)? *(?<message>.*)$
    Time_Key    time
    Time_Format %b %d %H:%M:%S
    Time_Keep   On

# Syslog 파서 (RFC5424)
[PARSER]
    Name        syslog-rfc5424
    Format      regex
    Regex       ^\<(?<pri>[0-9]{1,5})\>1 (?<time>[^ ]+) (?<host>[^ ]+) (?<ident>[^ ]+) (?<pid>[-0-9]+) (?<msgid>[^ ]+) (?<extradata>(\[(.*)\]|-)) (?<message>.+)$
    Time_Key    time
    Time_Format %Y-%m-%dT%H:%M:%S.%L%z
    Time_Keep   On

# Nginx 액세스 로그 파서
[PARSER]
    Name        nginx
    Format      regex
    Regex       '^(?<remote>[^ ]*) (?<host>[^ ]*) (?<user>[^ ]*) \[(?<time>[^\]]*)\] "(?<method>\S+)(?: +(?<path>[^\"]*?)(?: +\S*)?)?" (?<code>[^ ]*) (?<size>[^ ]*)(?: "(?<referer>[^\"]*)" "(?<agent>[^\"]*)")$'
    Time_Key    time
    Time_Format %d/%b/%Y:%H:%M:%S %z
    Time_Keep   On
    Types       code:integer size:integer

# systemd journal 파서
[PARSER]
    Name        systemd
    Format      regex
    Regex       ^(?<timestamp>[^ ]+) (?<hostname>[^ ]+) (?<unit>[^ ]+)\[(?<pid>\d+)\]: (?<message>.*)$
    Time_Key    timestamp
    Time_Format %b %d %H:%M:%S
    Time_Keep   On
