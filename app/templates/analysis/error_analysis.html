<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì—ëŸ¬ ë¶„ì„ ë¦¬í¬íŠ¸ - Log #{{ log_id }}</title>

    {%- if style.css_framework == 'tailwind' %}
    <script src="https://cdn.tailwindcss.com"></script>
    {%- elif style.css_framework == 'bootstrap' %}
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    {%- endif %}

    {%- if options.includeCharts %}
    {%- if style.chart_library == 'chartjs' %}
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    {%- endif %}
    {%- endif %}

    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            {%- if style.dark_mode %}
            background-color: #1a1a1a;
            color: #e0e0e0;
            {%- else %}
            background-color: #ffffff;
            color: #333;
            {%- endif %}
        }

        .content-card {
            {%- if style.dark_mode %}
            background-color: #2a2a2a;
            border: 1px solid #404040;
            {%- else %}
            background-color: white;
            border: 1px solid #e0e0e0;
            {%- endif %}
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .section-title {
            font-size: 18px;
            font-weight: 500;
            margin-bottom: 16px;
            margin-top: 0;
            padding-bottom: 8px;
            border-bottom: 2px solid {{ '#ef4444' if style.color_scheme == 'red' else '#3b82f6' if style.color_scheme == 'blue' else '#10b981' }};
        }

        .severity-badge {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 14px;
            font-weight: 600;
            color: white;
        }

        .severity-high { background-color: #ef4444; }
        .severity-medium { background-color: #f59e0b; }
        .severity-low { background-color: #3b82f6; }

        .code-block {
            {%- if style.dark_mode %}
            background-color: #1a1a1a;
            {%- else %}
            background-color: #f9fafb;
            {%- endif %}
            border: 1px solid {% if style.dark_mode %}#404040{% else %}#e5e7eb{% endif %};
            border-radius: 6px;
            padding: 16px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            overflow-x: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .info-row {
            display: flex;
            padding: 12px 0;
            border-bottom: 1px solid {% if style.dark_mode %}#404040{% else %}#e0e0e0{% endif %};
        }

        .info-row:last-child {
            border-bottom: none;
        }

        .info-label {
            font-weight: 600;
            min-width: 150px;
            {%- if style.dark_mode %}
            color: #a0a0a0;
            {%- else %}
            color: #666;
            {%- endif %}
        }

        .info-value {
            flex: 1;
        }

        .tag {
            display: inline-block;
            padding: 4px 8px;
            margin: 4px 4px 4px 0;
            border-radius: 4px;
            font-size: 12px;
            {%- if style.dark_mode %}
            background-color: #404040;
            {%- else %}
            background-color: #e5e7eb;
            {%- endif %}
        }

        .related-log {
            {%- if style.dark_mode %}
            background-color: #1a1a1a;
            border-left: 3px solid #3b82f6;
            {%- else %}
            background-color: #f9fafb;
            border-left: 3px solid #3b82f6;
            {%- endif %}
            padding: 12px;
            margin-bottom: 12px;
            border-radius: 4px;
        }

        .timestamp {
            font-size: 12px;
            {%- if style.dark_mode %}
            color: #808080;
            {%- else %}
            color: #999;
            {%- endif %}
        }

        .solution-section {
            margin-top: 16px;
        }

        .solution-item {
            margin-bottom: 12px;
            padding-left: 24px;
            position: relative;
        }

        .solution-item::before {
            content: "â†’";
            position: absolute;
            left: 0;
            font-weight: 700;
            color: {{ '#ef4444' if style.color_scheme == 'red' else '#3b82f6' if style.color_scheme == 'blue' else '#10b981' }};
        }

        /* Markdown rendered content styles */
        .content-card h1, .content-card h2, .content-card h3 {
            margin-top: 16px;
            margin-bottom: 8px;
        }

        .content-card ul, .content-card ol {
            padding-left: 24px;
            margin: 12px 0;
        }

        .content-card li {
            margin-bottom: 8px;
        }

        .content-card li input[type="checkbox"] {
            margin-right: 8px;
        }

        .content-card strong {
            font-weight: 700;
            {%- if style.color_scheme == 'red' %}
            color: #dc2626;
            {%- elif style.color_scheme == 'blue' %}
            color: #2563eb;
            {%- else %}
            color: #059669;
            {%- endif %}
        }

        .content-card code {
            {%- if style.dark_mode %}
            background-color: #1a1a1a;
            {%- else %}
            background-color: #f3f4f6;
            {%- endif %}
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }

        .content-card pre {
            {%- if style.dark_mode %}
            background-color: #1a1a1a;
            {%- else %}
            background-color: #f3f4f6;
            {%- endif %}
            padding: 12px;
            border-radius: 6px;
            overflow-x: auto;
            margin: 12px 0;
        }

        .content-card blockquote {
            border-left: 4px solid {{ '#ef4444' if style.color_scheme == 'red' else '#3b82f6' if style.color_scheme == 'blue' else '#10b981' }};
            padding-left: 16px;
            margin: 12px 0;
            {%- if style.dark_mode %}
            color: #a0a0a0;
            {%- else %}
            color: #666;
            {%- endif %}
        }
    </style>
</head>
<body>
    <div style="max-width: 1200px; margin: 0 auto; padding: 40px 20px;">
        <!-- Header -->
        <header style="margin-bottom: 40px;">
            <h1 style="font-size: 36px; font-weight: 800; margin-bottom: 8px;">
                ì—ëŸ¬ ë¶„ì„ ë¦¬í¬íŠ¸
            </h1>
            <p style="font-size: 16px; {% if style.dark_mode %}color: #a0a0a0;{% else %}color: #666;{% endif %}">
                Log ID: {{ log_id }}
            </p>
            <p class="timestamp">
                {{ error_log.timestamp if error_log.timestamp else 'N/A' }}
            </p>
        </header>

        <!-- Error Summary -->
        <section class="content-card">
            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 20px;">
                <h2 class="section-title" style="margin-bottom: 0;">ì—ëŸ¬ ê°œìš”</h2>
                <span class="severity-badge {% if error_log.level == 'ERROR' %}severity-high{% elif error_log.level == 'WARN' %}severity-medium{% else %}severity-low{% endif %}">
                    {{ error_log.level if error_log.level else 'ERROR' }}
                </span>
            </div>

            <div class="info-row">
                <div class="info-label">ì»´í¬ë„ŒíŠ¸</div>
                <div class="info-value">{{ error_log.componentName if error_log.componentName else 'Unknown' }}</div>
            </div>

            {%- if error_log.traceId %}
            <div class="info-row">
                <div class="info-label">Trace ID</div>
                <div class="info-value"><code>{{ error_log.traceId }}</code></div>
            </div>
            {%- endif %}

            <div class="info-row">
                <div class="info-label">ë©”ì‹œì§€</div>
                <div class="info-value">{{ error_log.message if error_log.message else 'No message available' }}</div>
            </div>

            {%- if existing_analysis and existing_analysis.tags %}
            <div class="info-row">
                <div class="info-label">íƒœê·¸</div>
                <div class="info-value">
                    {%- for tag in existing_analysis.tags %}
                    <span class="tag">{{ tag }}</span>
                    {%- endfor %}
                </div>
            </div>
            {%- endif %}
        </section>

        <!-- AI Analysis -->
        {%- if existing_analysis %}
        <section class="content-card">
            <h2 class="section-title">AI ë¶„ì„ ê²°ê³¼</h2>

            {%- if existing_analysis.summary %}
            <div style="margin-bottom: 24px;">
                <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 8px;">ğŸ“‹ ìš”ì•½</h3>
                <div>{{ existing_analysis.summary | markdown }}</div>
            </div>
            {%- endif %}

            {%- if existing_analysis.errorCause %}
            <div style="margin-bottom: 24px;">
                <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 8px;">ğŸ” ê·¼ë³¸ ì›ì¸ ë¶„ì„ (RCA)</h3>
                <div>{{ existing_analysis.errorCause | markdown }}</div>
            </div>
            {%- endif %}

            {%- if existing_analysis.solution %}
            <div class="solution-section">
                <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 12px;">ğŸ’¡ í•´ê²° ë°©ì•ˆ</h3>
                <div>{{ existing_analysis.solution | markdown }}</div>
            </div>
            {%- endif %}
        </section>
        {%- endif %}

        <!-- Stack Trace -->
        {%- if error_log.stackTrace %}
        <section class="content-card">
            <h2 class="section-title">ìŠ¤íƒ íŠ¸ë ˆì´ìŠ¤</h2>
            <div class="code-block">{{ error_log.stackTrace }}</div>
        </section>
        {%- endif %}

        <!-- Related Logs -->
        {%- if options.includeRelatedLogs and related_logs %}
        <section class="content-card">
            <h2 class="section-title">ê´€ë ¨ ë¡œê·¸ (Trace ID: {{ error_log.traceId }})</h2>

            <p style="{% if style.dark_mode %}color: #a0a0a0;{% else %}color: #666;{% endif %}; margin-bottom: 16px;">
                ë™ì¼í•œ Trace IDë¥¼ ê°€ì§„ {{ related_logs | length }}ê°œì˜ ê´€ë ¨ ë¡œê·¸ê°€ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤.
            </p>

            {%- for log in related_logs[:10] %}
            <div class="related-log">
                <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 4px;">
                    <div style="font-weight: 600;">
                        {{ log.message if log.message else 'No message' }}
                    </div>
                    <span style="background-color: {% if log.logLevel == 'ERROR' %}#ef4444{% elif log.logLevel == 'WARN' %}#f59e0b{% else %}#3b82f6{% endif %}; color: white; padding: 2px 6px; border-radius: 3px; font-size: 11px; font-weight: 600;">
                        {{ log.logLevel }}
                    </span>
                </div>
                <div class="timestamp">
                    {{ log.timestamp }} | {{ log.componentName if log.componentName else 'Unknown' }}
                </div>
            </div>
            {%- endfor %}
        </section>
        {%- endif %}

        <!-- Impact Analysis -->
        {%- if options.includeImpactAnalysis %}
        <section class="content-card">
            <h2 class="section-title">ì˜í–¥ ë¶„ì„</h2>

            <div class="info-row">
                <div class="info-label">ì˜í–¥ë°›ì€ ìš”ì²­ ìˆ˜</div>
                <div class="info-value">
                    {%- if related_logs %}
                    {{ related_logs | length }}ê°œì˜ ê´€ë ¨ ë¡œê·¸
                    {%- else %}
                    ë¶„ì„ ë°ì´í„° ì—†ìŒ
                    {%- endif %}
                </div>
            </div>

            <div class="info-row">
                <div class="info-label">ì‹¬ê°ë„ í‰ê°€</div>
                <div class="info-value">
                    {%- if error_log.level == 'ERROR' %}
                    <strong style="color: #ef4444;">ë†’ìŒ (HIGH)</strong> - ì¦‰ê°ì ì¸ ì¡°ì¹˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.
                    {%- elif error_log.level == 'WARN' %}
                    <strong style="color: #f59e0b;">ë³´í†µ (MEDIUM)</strong> - ëª¨ë‹ˆí„°ë§ì´ í•„ìš”í•©ë‹ˆë‹¤.
                    {%- else %}
                    <strong style="color: #3b82f6;">ë‚®ìŒ (LOW)</strong> - ì°¸ê³ ìš© ì •ë³´ì…ë‹ˆë‹¤.
                    {%- endif %}
                </div>
            </div>

            <div class="info-row">
                <div class="info-label">ê¶Œì¥ ì¡°ì¹˜ ì‹œê°„</div>
                <div class="info-value">
                    {%- if error_log.level == 'ERROR' %}
                    ì¦‰ì‹œ (1ì‹œê°„ ì´ë‚´)
                    {%- elif error_log.level == 'WARN' %}
                    24ì‹œê°„ ì´ë‚´
                    {%- else %}
                    ë‹¤ìŒ ìœ ì§€ë³´ìˆ˜ ì¼ì •
                    {%- endif %}
                </div>
            </div>
        </section>
        {%- endif %}

        <!-- Recommendations -->
        <section class="content-card">
            <h2 class="section-title">ì¡°ì¹˜ ê¶Œì¥ì‚¬í•­</h2>

            <ul style="list-style-type: none; padding: 0; margin: 0;">
                <li style="padding: 12px 0; border-bottom: 1px solid {% if style.dark_mode %}#404040{% else %}#e0e0e0{% endif %};">
                    <strong>1. ì—ëŸ¬ ì¬í˜„:</strong> ë™ì¼í•œ ì¡°ê±´ì—ì„œ ì—ëŸ¬ë¥¼ ì¬í˜„í•˜ì—¬ ê·¼ë³¸ ì›ì¸ì„ íŒŒì•…í•˜ì„¸ìš”.
                </li>

                <li style="padding: 12px 0; border-bottom: 1px solid {% if style.dark_mode %}#404040{% else %}#e0e0e0{% endif %};">
                    <strong>2. ì½”ë“œ ê²€í† :</strong> {{ error_log.componentName if error_log.componentName else 'í•´ë‹¹ ì»´í¬ë„ŒíŠ¸' }}ì˜ ì½”ë“œë¥¼ ê²€í† í•˜ê³  ì˜ˆì™¸ ì²˜ë¦¬ë¥¼ ê°•í™”í•˜ì„¸ìš”.
                </li>

                {%- if related_logs %}
                <li style="padding: 12px 0; border-bottom: 1px solid {% if style.dark_mode %}#404040{% else %}#e0e0e0{% endif %};">
                    <strong>3. íŒ¨í„´ ë¶„ì„:</strong> {{ related_logs | length }}ê°œì˜ ê´€ë ¨ ë¡œê·¸ë¥¼ ë¶„ì„í•˜ì—¬ ê³µí†µ íŒ¨í„´ì„ ì°¾ìœ¼ì„¸ìš”.
                </li>
                {%- endif %}

                <li style="padding: 12px 0; border-bottom: 1px solid {% if style.dark_mode %}#404040{% else %}#e0e0e0{% endif %};">
                    <strong>4. ëª¨ë‹ˆí„°ë§ ì„¤ì •:</strong> ìœ ì‚¬í•œ ì—ëŸ¬ ë°œìƒ ì‹œ ì¦‰ì‹œ ì•Œë¦¼ì„ ë°›ë„ë¡ ëª¨ë‹ˆí„°ë§ì„ ì„¤ì •í•˜ì„¸ìš”.
                </li>

                <li style="padding: 12px 0;">
                    <strong>5. ë¬¸ì„œí™”:</strong> í•´ê²° ê³¼ì •ê³¼ ë°©ë²•ì„ ë¬¸ì„œí™”í•˜ì—¬ í–¥í›„ ì°¸ê³ í•  ìˆ˜ ìˆë„ë¡ í•˜ì„¸ìš”.
                </li>
            </ul>
        </section>

        <!-- Footer -->
        <footer style="margin-top: 40px; padding-top: 20px; border-top: 1px solid {% if style.dark_mode %}#404040{% else %}#e0e0e0{% endif %}; text-align: center;">
            <p class="timestamp">
                Generated by LogLens AI Analysis | {{ error_log.timestamp if error_log.timestamp else 'N/A' }}
            </p>
        </footer>
    </div>
</body>
</html>
