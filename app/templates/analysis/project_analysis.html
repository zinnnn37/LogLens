<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ project_info.name }} - í”„ë¡œì íŠ¸ ë¶„ì„ ë¦¬í¬íŠ¸</title>

    {%- if style.css_framework == 'tailwind' %}
    <script src="https://cdn.tailwindcss.com"></script>
    {%- elif style.css_framework == 'bootstrap' %}
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    {%- endif %}

    {%- if options.includeCharts %}
    {%- if style.chart_library == 'chartjs' %}
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    {%- endif %}
    {%- endif %}

    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            {%- if style.dark_mode %}
            background-color: #1a1a1a;
            color: #e0e0e0;
            {%- else %}
            background-color: #f5f5f5;
            color: #333;
            {%- endif %}
        }

        .metric-card {
            {%- if style.dark_mode %}
            background-color: #2a2a2a;
            border: 1px solid #404040;
            {%- else %}
            background-color: white;
            border: 1px solid #e0e0e0;
            {%- endif %}
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .section-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 16px;
            padding-bottom: 8px;
            border-bottom: 2px solid {{ '#3b82f6' if style.color_scheme == 'blue' else '#10b981' if style.color_scheme == 'green' else '#ef4444' }};
        }

        .metric-value {
            font-size: 32px;
            font-weight: 700;
            color: {{ '#3b82f6' if style.color_scheme == 'blue' else '#10b981' if style.color_scheme == 'green' else '#ef4444' }};
        }

        .metric-label {
            font-size: 14px;
            {%- if style.dark_mode %}
            color: #a0a0a0;
            {%- else %}
            color: #666;
            {%- endif %}
            margin-top: 4px;
        }

        .error-item {
            {%- if style.dark_mode %}
            background-color: #2a2a2a;
            border-left: 4px solid #ef4444;
            {%- else %}
            background-color: #fef2f2;
            border-left: 4px solid #ef4444;
            {%- endif %}
            padding: 12px;
            margin-bottom: 12px;
            border-radius: 4px;
        }

        .timestamp {
            font-size: 12px;
            {%- if style.dark_mode %}
            color: #808080;
            {%- else %}
            color: #999;
            {%- endif %}
        }

        .health-score {
            font-size: 48px;
            font-weight: 700;
        }

        .health-good { color: #10b981; }
        .health-medium { color: #f59e0b; }
        .health-poor { color: #ef4444; }
    </style>
</head>
<body>
    <div style="max-width: 1200px; margin: 0 auto; padding: 40px 20px;">
        <!-- Header -->
        <header style="margin-bottom: 40px;">
            <h1 style="font-size: 36px; font-weight: 800; margin-bottom: 8px;">
                {{ project_info.name }}
            </h1>
            <p style="font-size: 16px; {% if style.dark_mode %}color: #a0a0a0;{% else %}color: #666;{% endif %}">
                í”„ë¡œì íŠ¸ ë¶„ì„ ë¦¬í¬íŠ¸
            </p>
            {%- if time_range %}
            <p class="timestamp">
                ë¶„ì„ ê¸°ê°„: {{ time_range.startTime if time_range.startTime else 'All time' }} ~ {{ time_range.endTime }}
            </p>
            {%- endif %}
        </header>

        <!-- Overview Section -->
        <section class="metric-card">
            <h2 class="section-title">ê°œìš”</h2>

            {%- if project_info.description %}
            <p style="margin-bottom: 20px;">{{ project_info.description }}</p>
            {%- endif %}

            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                {%- set total_logs = metrics.totalLogs | default(0) %}
                {%- set error_count = metrics.errorCount | default(0) %}
                {%- set warn_count = metrics.warnCount | default(0) %}

                <div style="text-align: center;">
                    <div class="metric-value">{{ total_logs | format_number }}</div>
                    <div class="metric-label">ì´ ë¡œê·¸ ìˆ˜</div>
                </div>

                <div style="text-align: center;">
                    <div class="metric-value" style="color: #ef4444;">{{ error_count | format_number }}</div>
                    <div class="metric-label">ì—ëŸ¬ ({{ error_count | format_percentage(total_logs) }})</div>
                </div>

                <div style="text-align: center;">
                    <div class="metric-value" style="color: #f59e0b;">{{ warn_count | format_number }}</div>
                    <div class="metric-label">ê²½ê³  ({{ warn_count | format_percentage(total_logs) }})</div>
                </div>

                {%- if metrics.avgResponseTime is defined %}
                <div style="text-align: center;">
                    <div class="metric-value">{{ metrics.avgResponseTime | round(2) }}ms</div>
                    <div class="metric-label">í‰ê·  ì‘ë‹µ ì‹œê°„</div>
                </div>
                {%- endif %}
            </div>
        </section>

        {%- if ai_insights and ai_insights.system_health_summary %}
        <!-- AI Insights Section -->
        <section class="metric-card" style="{% if style.dark_mode %}background: linear-gradient(135deg, #1e3a8a 0%, #1e40af 100%);{% else %}background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);{% endif %} border-left: 4px solid #3b82f6;">
            <div style="display: flex; align-items: start; gap: 16px;">
                <div style="flex-shrink: 0; font-size: 32px;">
                    ğŸ¤–
                </div>
                <div style="flex: 1;">
                    <h2 style="font-size: 20px; font-weight: 700; margin-bottom: 12px; {% if style.dark_mode %}color: #60a5fa;{% else %}color: #1e40af;{% endif %}">
                        AI ì¸ì‚¬ì´íŠ¸
                    </h2>
                    <p style="font-size: 15px; line-height: 1.6; {% if style.dark_mode %}color: #e0e0e0;{% else %}color: #1e3a8a;{% endif %}">
                        {{ ai_insights.system_health_summary }}
                    </p>
                    <p style="font-size: 12px; margin-top: 12px; {% if style.dark_mode %}color: #a0a0a0;{% else %}color: #64748b;{% endif %}">
                        * AIê°€ ì‹¤ì‹œê°„ ë¡œê·¸ ë°ì´í„°ë¥¼ ë¶„ì„í•˜ì—¬ ìƒì„±í•œ ì¸ì‚¬ì´íŠ¸ì…ë‹ˆë‹¤
                    </p>
                </div>
            </div>
        </section>
        {%- endif %}

        <!-- Health Score Section -->
        <section class="metric-card">
            <h2 class="section-title">í”„ë¡œì íŠ¸ ìƒíƒœ</h2>

            {%- set health_score = ((100 - (error_count / total_logs * 1000) - (warn_count / total_logs * 100)) | int) if total_logs > 0 else 100 %}
            {%- set health_score = [0, health_score] | max %}
            {%- set health_score = [100, health_score] | min %}

            <div style="text-align: center; padding: 20px;">
                <div class="health-score {% if health_score >= 80 %}health-good{% elif health_score >= 50 %}health-medium{% else %}health-poor{% endif %}">
                    {{ health_score }}
                </div>
                <div class="metric-label">ê±´ê°• ì ìˆ˜ (100ì  ë§Œì )</div>

                <p style="margin-top: 20px; font-size: 14px;">
                    {%- if health_score >= 80 %}
                    âœ… í”„ë¡œì íŠ¸ ìƒíƒœê°€ ì–‘í˜¸í•©ë‹ˆë‹¤.
                    {%- elif health_score >= 50 %}
                    âš ï¸ ì£¼ì˜ê°€ í•„ìš”í•©ë‹ˆë‹¤. ì¼ë¶€ ê°œì„ ì´ ê¶Œì¥ë©ë‹ˆë‹¤.
                    {%- else %}
                    ğŸ”´ ì¦‰ê°ì ì¸ ì¡°ì¹˜ê°€ í•„ìš”í•©ë‹ˆë‹¤. ì‹¬ê°í•œ ë¬¸ì œê°€ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤.
                    {%- endif %}
                </p>
            </div>
        </section>

        {%- if options.includeCharts and metrics %}
        <!-- Charts Section -->
        <section class="metric-card">
            <h2 class="section-title">ë¡œê·¸ ë ˆë²¨ ë¶„í¬</h2>
            <canvas id="levelDistributionChart" style="max-height: 300px;"></canvas>
        </section>
        {%- endif %}

        <!-- Top Errors Section -->
        {%- if top_errors %}
        <section class="metric-card">
            <h2 class="section-title">ìµœê·¼ ì—ëŸ¬ ë¡œê·¸</h2>

            {%- for error in top_errors[:10] %}
            <div class="error-item">
                <div style="display: flex; justify-content: space-between; align-items: start;">
                    <div style="flex: 1;">
                        <div style="font-weight: 600; margin-bottom: 4px;">
                            {{ error.message if error.message else 'No message' }}
                        </div>
                        <div class="timestamp">
                            {{ error.timestamp }} | {{ error.componentName if error.componentName else 'Unknown component' }}
                        </div>
                        {%- if error.traceId %}
                        <div class="timestamp">Trace ID: {{ error.traceId }}</div>
                        {%- endif %}
                    </div>
                    <div style="background-color: #ef4444; color: white; padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: 600;">
                        {{ error.logLevel if error.logLevel else 'ERROR' }}
                    </div>
                </div>
            </div>
            {%- endfor %}
        </section>
        {%- endif %}

        <!-- Recommendations Section -->
        <section class="metric-card">
            <h2 class="section-title">ê¶Œì¥ì‚¬í•­</h2>

            <ul style="list-style-type: none; padding: 0; margin: 0;">
                {%- if error_count > 0 %}
                <li style="padding: 12px 0; border-bottom: 1px solid {% if style.dark_mode %}#404040{% else %}#e0e0e0{% endif %};">
                    <strong>ğŸ”´ ì—ëŸ¬ ë¡œê·¸ ë¶„ì„:</strong> {{ error_count }}ê±´ì˜ ì—ëŸ¬ê°€ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤. ì£¼ìš” ì—ëŸ¬ íŒ¨í„´ì„ ë¶„ì„í•˜ê³  ê·¼ë³¸ ì›ì¸ì„ íŒŒì•…í•˜ì„¸ìš”.
                </li>
                {%- endif %}

                {%- if warn_count > total_logs * 0.1 %}
                <li style="padding: 12px 0; border-bottom: 1px solid {% if style.dark_mode %}#404040{% else %}#e0e0e0{% endif %};">
                    <strong>âš ï¸ ê²½ê³  ë¡œê·¸ ê²€í† :</strong> ê²½ê³  ë¡œê·¸ ë¹„ìœ¨ì´ ë†’ìŠµë‹ˆë‹¤ ({{ warn_count | format_percentage(total_logs) }}). ì ì¬ì  ë¬¸ì œë¥¼ ì‚¬ì „ì— ë°©ì§€í•˜ì„¸ìš”.
                </li>
                {%- endif %}

                {%- if metrics.avgResponseTime and metrics.avgResponseTime > 1000 %}
                <li style="padding: 12px 0; border-bottom: 1px solid {% if style.dark_mode %}#404040{% else %}#e0e0e0{% endif %};">
                    <strong>âš¡ ì„±ëŠ¥ ìµœì í™”:</strong> í‰ê·  ì‘ë‹µ ì‹œê°„ì´ {{ metrics.avgResponseTime | round(2) }}msì…ë‹ˆë‹¤. ì„±ëŠ¥ ê°œì„ ì„ ê³ ë ¤í•˜ì„¸ìš”.
                </li>
                {%- endif %}

                <li style="padding: 12px 0;">
                    <strong>ğŸ“Š ëª¨ë‹ˆí„°ë§ ê°•í™”:</strong> ì£¼ê¸°ì ì¸ ë¡œê·¸ ë¶„ì„ì„ í†µí•´ ì‹œìŠ¤í…œ ìƒíƒœë¥¼ ì§€ì†ì ìœ¼ë¡œ ëª¨ë‹ˆí„°ë§í•˜ì„¸ìš”.
                </li>
            </ul>
        </section>

        <!-- Footer -->
        <footer style="margin-top: 40px; padding-top: 20px; border-top: 1px solid {% if style.dark_mode %}#404040{% else %}#e0e0e0{% endif %}; text-align: center;">
            <p class="timestamp">
                Generated by LogLens AI Analysis | {{ time_range.endTime if time_range and time_range.endTime else 'N/A' }}
            </p>
        </footer>
    </div>

    {%- if options.includeCharts and metrics %}
    <script>
        // Level Distribution Chart
        const ctx = document.getElementById('levelDistributionChart');
        if (ctx) {
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['ì—ëŸ¬', 'ê²½ê³ ', 'ì •ë³´'],
                    datasets: [{
                        data: [
                            {{ metrics.errorCount | default(0) }},
                            {{ metrics.warnCount | default(0) }},
                            {{ metrics.infoCount | default(0) }}
                        ],
                        backgroundColor: [
                            '#ef4444',
                            '#f59e0b',
                            '#3b82f6'
                        ],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: '{{ "#e0e0e0" if style.dark_mode else "#333" }}',
                                font: {
                                    size: 14
                                }
                            }
                        }
                    }
                }
            });
        }
    </script>
    {%- endif %}
</body>
</html>
