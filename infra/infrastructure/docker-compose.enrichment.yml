version: '3.8'

services:
  ai-enrichment-consumer:
    container_name: ai-enrichment-consumer
    build:
      context: ../..
      dockerfile: Dockerfile
    command: python enrichment_consumer.py
    environment:
      # Kafka configuration
      KAFKA_BOOTSTRAP_SERVERS: kafka:19092
      KAFKA_TOPIC: application-logs
      CONSUMER_GROUP_ID: ai-enrichment-consumer

      # OpenSearch configuration
      OPENSEARCH_HOST: opensearch
      OPENSEARCH_PORT: 9200
      OPENSEARCH_USER: admin
      OPENSEARCH_PASSWORD: admin

      # AI Service configuration
      AI_SERVICE_URL: http://ai-service:8000

      # Batch configuration
      ENRICHMENT_BATCH_SIZE: 50
      ENRICHMENT_BATCH_TIMEOUT: 5.0

      # OpenAI API (from .env)
      OPENAI_API_KEY: ${OPENAI_API_KEY}
      OPENAI_BASE_URL: ${OPENAI_BASE_URL}
    networks:
      - ai-loglens-network
    restart: unless-stopped
    depends_on:
      - kafka
      - opensearch
    volumes:
      - ../../enrichment_consumer.log:/app/enrichment_consumer.log
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

networks:
  ai-loglens-network:
    external: true
