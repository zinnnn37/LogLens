version: '3.8'

services:
  logstash:
    image: opensearchproject/logstash-oss-with-opensearch-output-plugin:8.9.0
    container_name: logstash
    volumes:
      - ./logstash.conf:/usr/share/logstash/pipeline/logstash.conf:ro
      - /data/logstash/logs:/usr/share/logstash/logs
    ports:
      - "9600:9600"  # Monitoring API
    environment:
      LS_JAVA_OPTS: "-Xmx1g -Xms1g"
      PIPELINE_WORKERS: 2
      LOG_LEVEL: info
    networks:
      - ai-loglens-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:9600/?pretty || exit 1"]
      interval: 30s
      timeout: 10s
      retries: 5
      start_period: 90s
    depends_on:
      - kafka
      - opensearch

networks:
  ai-loglens-network:
    name: ai-loglens-network
    driver: bridge