# docker-compose-app.yml
# Blue/Green ë°°í¬ë¥¼ ìœ„í•œ í…œí”Œë¦¿ (í¬íŠ¸ê°€ 8080 ë˜ëŠ” 8081ë¡œ ë³€ê²½ë¨)
# ci/cd íŒŒì´í”„ë¼ì¸ì—ì„œëŠ” ì‚¬ìš©ë˜ì§€ ì•Šê³  ì´í•´ë¥¼ ë•ê¸° ìœ„í•œ í…œí”Œë¦¿ì„

version: '3.8'

services:
  app:
    image: loglens-app:latest
    container_name: loglens-app-blue  # ë˜ëŠ” loglens-app-green
    ports:
      - "8080:8080"  # Blue: 8080:8080, Green: 8081:8080
    environment:
      - SPRING_PROFILES_ACTIVE=prod
      - SPRING_DATASOURCE_URL=jdbc:mysql://loglens-mysql:3306/loglens
      - SPRING_DATASOURCE_USERNAME=gonagi
      - SPRING_DATASOURCE_PASSWORD=Loglens306#)^
      - SPRING_REDIS_HOST=loglens-redis
      - SPRING_REDIS_PORT=6379
      - SPRING_REDIS_PASSWORD=your-redis-password
    restart: unless-stopped
    networks:
      - loglens-network
    depends_on:
      - mysql
      - redis
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/health-check"]
      interval: 10s
      timeout: 5s
      retries: 3
      start_period: 40s

networks:
  loglens-network:
    name: loglens-network    # ğŸ‘ˆ ëª…ì‹œì ìœ¼ë¡œ ì´ë¦„ ì§€ì •
    driver: bridge
