(function(u,f){typeof exports=="object"&&typeof module<"u"?f(exports,require("react")):typeof define=="function"&&define.amd?define(["exports","react"],f):(u=typeof globalThis<"u"?globalThis:u||self,f(u.soo1Loglens={},u.React))})(this,(function(u,f){"use strict";function R(o,t){const e=String(t.name);return function(...n){console.log(`[LOG] ${e}`,n);const i=o.apply(this,n);return console.log(`[RESULT] ${e}`,i),i}}class g{static stack=[];static isPatched=!1;static OriginalPromise=null;static init(){if(this.isPatched){console.warn("[LogLens] Already initialized");return}this.OriginalPromise=Promise,this.patchPromise(),this.isPatched=!0,console.log("[LogLens] Initialized - Auto trace propagation enabled")}static isEnabled(){return this.isPatched}static async runAsync(t,e){this.stack.push(t);try{return await e()}finally{this.stack.pop()}}static run(t,e){this.stack.push(t);try{return e()}finally{this.stack.pop()}}static current(){return this.stack[this.stack.length-1]||null}static getTraceId(){return this.current()?.traceId||null}static getDepth(){return this.stack.length}static reset(){this.stack=[],this.isPatched=!1}static patchPromise(){if(!this.OriginalPromise)throw new Error("[LogLens] OriginalPromise not initialized");const t=this.OriginalPromise,e=this;class n extends t{constructor(s){const r=e.current();super((a,c)=>{s(h=>{if(r&&e.current()!==r){e.stack.push(r);try{a(h)}finally{e.stack.pop()}}else a(h)},h=>{if(r&&e.current()!==r){e.stack.push(r);try{c(h)}finally{e.stack.pop()}}else c(h)})})}then(s,r){const a=e.current();return super.then(s?c=>{if(a&&e.current()!==a){e.stack.push(a);try{return s(c)}finally{e.stack.pop()}}return s(c)}:void 0,r?c=>{if(a&&e.current()!==a){e.stack.push(a);try{return r(c)}finally{e.stack.pop()}}return r(c)}:void 0)}}globalThis.Promise=n,n.resolve=function(i){return new n(s=>s(i))},n.reject=function(i){return new n((s,r)=>r(i))},n.all=function(i){return new n((s,r)=>{t.all(i).then(s,r)})},n.race=function(i){return new n((s,r)=>{t.race(i).then(s,r)})},n.allSettled=function(i){return new n(s=>{t.allSettled(i).then(s)})},t.any&&(n.any=function(i){return new n((s,r)=>{t.any(i).then(s,r)})}),console.log("[LogLens] Promise patched - TraceId auto-propagation active")}static getStatus(){return{isPatched:this.isPatched,stackDepth:this.stack.length,currentTraceId:this.getTraceId()}}}class T{static COLORS={INFO:"\x1B[30m",WARN:"\x1B[33m",ERROR:"\x1B[91m",RESET:"\x1B[0m",GRAY:"\x1B[90m",GREEN:"\x1B[32m",BOLD:"\x1B[1m"};static LEVEL_WIDTH=5;static toConsole(t){const e=Math.max(0,g.getDepth()-1),n="|".repeat(e),i="â†’",s=this.COLORS[t.level],r=this.COLORS.RESET,a=this.COLORS.GRAY,c=`${s}[${t.level.padStart(this.LEVEL_WIDTH)}]${r}`,h=this.getDurationColor(t.executionTimeMs),y=t.executionTimeMs!==null?`${h}(${t.executionTimeMs.toString().padStart(5)}ms)${r}`:"",l=t.logger||t.message||"anonymous",m=t.message?`${l}: ${a}${t.message}${r}`:l;return`${c} ${n}${i} ${m} ${y}`}static getDurationColor(t){return t===null?this.COLORS.GRAY:t>1e3?this.COLORS.ERROR:t>100?this.COLORS.WARN:this.COLORS.GREEN}}class d{static logs=[];static config={maxLogs:1e3,autoFlush:{enabled:!1,interval:6e4,endpoint:""}};static flushTimer=null;static init(t){t===null?this.config={maxLogs:1e3,autoFlush:{enabled:!1,interval:6e4,endpoint:""}}:this.config={...this.config,...t},this.config.autoFlush?.enabled&&this.startAutoFlush()}static addLog(t){this.logs.push(t);const e=T.toConsole(t);console.log(e),this.logs.length>(this.config.maxLogs||1e3)&&this.logs.shift()}static getLogs(){return[...this.logs]}static getLogsByTraceId(t){return this.logs.filter(e=>e.traceId===t)}static async flush(){if(this.logs.length===0)return;const t=this.config.autoFlush?.endpoint;if(!t){console.warn("[LogCollector] No endpoint configured for flush");return}const e=[...this.logs];this.logs=[];try{const n=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({logs:e})});if(!n.ok)throw new Error(`Failed to send logs: ${n.status}`);console.log(`[LogCollector] Successfully sent ${e.length} logs`)}catch(n){console.error("[LogCollector] Failed to flush logs:",n),this.logs.unshift(...e)}}static clear(){this.logs=[]}static startAutoFlush(){if(this.flushTimer)return;const t=this.config.autoFlush?.interval||6e4;this.flushTimer=setInterval(()=>{this.flush()},t),console.log(`[LogCollector] Auto flush started (interval: ${t}ms)`)}static stopAutoFlush(){this.flushTimer&&(clearInterval(this.flushTimer),this.flushTimer=null,console.log("[LogCollector] Auto flush stopped"))}static getStatus(){return{logCount:this.logs.length,maxLogs:this.config.maxLogs,autoFlushEnabled:this.config.autoFlush?.enabled||!1,endpoint:this.config.autoFlush?.endpoint||"not configured"}}}function S(){try{const t=new Error().stack;if(!t)return"anonymous";const e=t.split(`
`);for(let n=3;n<Math.min(e.length,8);n++){const i=e[n];let s=i.match(/at\s+(?:Object\.)?(\w+)\s*\(/)||i.match(/at\s+(\w+)\s/)||i.match(/^(\w+)@/);if(s&&s[1]){const r=s[1];if(!["withLogLens","extractFunctionName","runAsync","run","Object","Module","eval","anonymous","Function","mountMemo","useMemo"].includes(r))return r}}return"anonymous"}catch{return"anonymous"}}function p(o,t,e,n){return{"@timestamp":new Date().toISOString(),traceId:o,level:e,logger:t,message:n,layer:"FRONT"}}function I(o,t,e){d.addLog({...p(o,t,"INFO",`${t} called`),request:{method:t,parameters:e.length>0?e:void 0},response:null,executionTimeMs:null})}function L(o,t,e,n){d.addLog({...p(o,t,"INFO",`${t} completed`),request:{method:t},response:e,executionTimeMs:n})}function O(o,t,e,n){d.addLog({...p(o,t,"ERROR",e?.stack||e?.message||String(e)),request:{method:t},response:null,executionTimeMs:n})}function w(o,t){const e=t?.logger||(o.name&&o.name!=="anonymous"?o.name:null)||S(),n=o.constructor.name==="AsyncFunction";return((...i)=>{const s=crypto.randomUUID(),r=!t?.skipLog,a=Date.now();if(r&&I(s,e,i),n)return g.runAsync({traceId:s},async()=>{try{const l=await o(...i),m=Date.now()-a;return r&&L(s,e,l,m),l}catch(l){const m=Date.now()-a;throw O(s,e,l,m),l}});let c,h=null;if(g.run({traceId:s},()=>{try{c=o(...i)}catch(l){h=l}}),h){const l=Date.now()-a;throw O(s,e,h,l),h}if(c&&typeof c.then=="function")return c.then(l=>{const m=Date.now()-a;return r&&L(s,e,l,m),l}).catch(l=>{const m=Date.now()-a;throw O(s,e,l,m),l});const y=Date.now()-a;return r&&L(s,e,c,y),c})}function F(o,t,e=[]){return f.useMemo(()=>w(o,t),e)}const k={info:(o,t)=>{const e=g.getTraceId();d.addLog({"@timestamp":new Date().toISOString(),traceId:e||null,level:"INFO",logger:"loglens",message:o,layer:"FRONT",request:null,response:t||null,executionTimeMs:null})},warn:(o,t)=>{const e=g.getTraceId();d.addLog({"@timestamp":new Date().toISOString(),traceId:e||null,level:"WARN",logger:"loglens",message:o,layer:"FRONT",request:null,response:t||null,executionTimeMs:null})},error:(o,t)=>{const e=g.getTraceId();d.addLog({"@timestamp":new Date().toISOString(),traceId:e||null,level:"ERROR",logger:"loglens",message:t?.stack||o,layer:"FRONT",request:null,response:null,executionTimeMs:null})}};function x(o){const t=o||C();return{info:(e,n)=>{d.addLog({"@timestamp":new Date().toISOString(),traceId:g.getTraceId()||null,level:"INFO",logger:t,message:e,layer:"FRONT",request:null,response:n||null,executionTimeMs:null})},warn:(e,n)=>{d.addLog({"@timestamp":new Date().toISOString(),traceId:g.getTraceId()||null,level:"WARN",logger:t,message:e,layer:"FRONT",request:null,response:n||null,executionTimeMs:null})},error:(e,n)=>{d.addLog({"@timestamp":new Date().toISOString(),traceId:g.getTraceId()||null,level:"ERROR",logger:t,message:n?.stack||e,layer:"FRONT",request:null,response:null,executionTimeMs:null})}}}function C(){try{const t=new Error().stack;if(!t)return"anonymous";const e=t.split(`
`);for(let n=3;n<Math.min(e.length,6);n++){const i=e[n];let s=i.match(/at\s+([A-Z]\w+)/);if(s||(s=i.match(/^([A-Z]\w+)@/)),s&&s[1]){const r=s[1];if(!["useLogger","extractComponentName","renderWithHooks","updateFunctionComponent","beginWork","performUnitOfWork","workLoop","Object","Module","mountMemo","useMemo"].includes(r))return r}}return"anonymous"}catch{return"anonymous"}}u.LightZone=g,u.Log=R,u.LogCollector=d,u.LogFormatter=T,u.loglens=k,u.useLogLens=F,u.useLogger=x,u.withLogLens=w,Object.defineProperty(u,Symbol.toStringTag,{value:"Module"})}));
